<?php header(_152537142(0));error_reporting(E_ERROR|E_PARSE);$data=_152537142(1);function err($error){die("err: $error");}function myerr($err,$conn,$code_override){$e=mysqli_error($conn);if($e == _152537142(2))$e=$err;if($e == _152537142(3))$e=_152537142(4);$c=$code_override;if(!$c)$c=mysqli_errno($conn);if($c)$e=$c ._152537142(5) .$e;mysqli_free_result(mysqli_query($conn,_152537142(6)));err($e);}function pgerr($err){$e=pg_last_error();if($e == _152537142(7))$e=$err;if($e == _152537142(8))$e=_152537142(9);pg_free_result(pg_query(_152537142(10)));err($e);}function dump($val){global $data;$len=strlen($val);if($len<255)$data .= chr($len);else $data .= _152537142(11) .pack(_152537142(12),$len);$data .= $val;if(strlen($data)>100000){echo $data;$data=_152537142(13);}}if(isset($_GET[_152537142(14)])){require_once _152537142(15);}$_POST[_152537142(16)]=$dbuser;$_POST[_152537142(17)]=$dbpass;$host=_152537142(18);if(!array_key_exists(_152537142(19),$_POST)){header(_152537142(20));exit;}array_key_exists(_152537142(21),$_POST)and array_key_exists(_152537142(22),$_POST)and array_key_exists(_152537142(23),$_POST)and array_key_exists(_152537142(24),$_POST)and array_key_exists(_152537142(25),$_POST)and array_key_exists(_152537142(26),$_POST)or err(_152537142(27));if(get_magic_quotes_gpc())foreach($_POST as $key => $value)$_POST[$key]=stripslashes($value);$commit=array_key_exists(_152537142(28),$_POST);if($_POST[_152537142(29)]== _152537142(30)){$port=$socket=$_POST[_152537142(31)];$host=$_POST[_152537142(32)];if(is_numeric($port))$socket=null;else{if(substr($socket,0,1)!= _152537142(33)){$socket="\\\\.\\pipe\\$socket";$host=_152537142(34);}else $host=_152537142(35);$port=null;}$conn=mysqli_connect($host,$_POST[_152537142(36)],$_POST[_152537142(37)],null,$port,$socket)or myerr(mysqli_connect_error(),$conn,mysqli_connect_errno());if($_POST[_152537142(38)]!= _152537142(39))mysqli_select_db($conn,$_POST[_152537142(40)])or myerr(_152537142(41),$conn,null);if(array_key_exists(_152537142(42),$_POST)&& $_POST[_152537142(43)]!= _152537142(44))mysqli_query($conn,_152537142(45) .$_POST[_152537142(46)] ._152537142(47))or myerr(_152537142(48),$conn,null);$result=FALSE;mysqli_free_result(mysqli_query($conn,_152537142(49)));for($rn=1;$rn<1000;++$rn){if(!array_key_exists(_152537142(50) .$rn,$_POST))break;$data=_152537142(51);$req=$_POST[_152537142(52) .$rn];if($req == _152537142(53)){dump(mysqli_get_server_info($conn));dump(mysqli_get_client_info($conn));dump(mysqli_get_proto_info($conn));dump(mysqli_get_host_info($conn));}else{$result=mysqli_query($conn,$req)or myerr(_152537142(54),$conn,null);if($result === TRUE){dump(0);dump(mysqli_affected_rows($conn));}else{$width=mysqli_num_fields($result);$height=mysqli_num_rows($result);dump($width);dump($height);for($i=0;$i<$width;++$i){$properties=mysqli_fetch_field_direct($result,$i);dump($properties->name);dump($properties->type);dump($properties->flags);dump($properties->length);}for($i=0;$i<$height;++$i){$row=mysqli_fetch_row($result);for($j=0;$j<$width;++$j)if(is_null($row[$j]))dump(_152537142(55));else dump(_152537142(56) .$row[$j]);}mysqli_free_result($result);}}}mysqli_free_result(mysqli_query($conn,$commit?_152537142(57):_152537142(58)));}elseif($_POST[_152537142(59)]== _152537142(60)){$conn=_152537142(61);if($_POST[_152537142(62)]!= _152537142(63))$conn .="host=$_POST[host]";if($_POST[_152537142(64)]!= _152537142(65))$conn .=" port=$_POST[port]";if($_POST[_152537142(66)]!= _152537142(67))$conn .=" dbname=$_POST[dbname]";if($_POST[_152537142(68)]!= _152537142(69))$conn .=" user=$_POST[user]";if($_POST[_152537142(70)]!= _152537142(71))$conn .=" password=$_POST[password]";$conn=pg_connect($conn)|| pgerr(_152537142(72));if(!$commit || array_key_exists(_152537142(73),$_POST))pg_free_result(pg_query(_152537142(74)));$result=FALSE;for($rn=1;$rn<1000;++$rn){if(!array_key_exists(_152537142(75) .$rn,$_POST))break;$data=_152537142(76);$req=$_POST[_152537142(77) .$rn];if($req == _152537142(78)){dump(0);dump(0);dump(0);}elseif(substr($req,0,11)== _152537142(79)){list($oid)=sscanf($req,_152537142(80));pg_free_result(pg_query($commit?_152537142(81):_152537142(82)));pg_free_result(pg_query(_152537142(83)));$oid=pg_lo_create()or pgerr(_152537142(84));pg_free_result(pg_query(_152537142(85)));pg_free_result(pg_query(_152537142(86)));dump($oid);}elseif(substr($req,0,11)== _152537142(87)){list($oid)=sscanf($req,_152537142(88));$oid=pg_lo_unlink($oid)or pgerr(_152537142(89));}elseif(substr($req,0,10)== _152537142(90)){list($oid)=sscanf($req,_152537142(91));$bin=substr($req,12+strlen($oid));$obj=pg_lo_open($oid,_152537142(92))or pgerr(_152537142(93));$res=pg_lo_write($obj,$bin)or pgerr(_152537142(94));pg_lo_close($obj);dump($res);}elseif(substr($req,0,9)== _152537142(95)){list($oid)=sscanf($req,_152537142(96));$obj=pg_lo_open($oid,_152537142(97))or pgerr(_152537142(98));pg_lo_seek($obj,0,PGSQL_SEEK_END);$len=pg_lo_tell($obj);pg_lo_seek($obj,0,PGSQL_SEEK_SET);$res=pg_lo_read($obj,$len)or pgerr(_152537142(99));pg_lo_close($obj);dump($res);}else{$result=pg_query($req)or pgerr("error at request: $req");if(pg_result_status($result)== PGSQL_COMMAND_OK){dump(0);dump(pg_affected_rows($result));dump(pg_last_oid($result));pg_free_result($result);}elseif(pg_result_status($result)== PGSQL_EMPTY_QUERY){dump(0);dump(0);pg_free_result($result);}elseif(pg_result_status($result)== PGSQL_TUPLES_OK){$width=pg_num_fields($result);$height=pg_num_rows($result);dump($width);dump($height);for($i=0;$i<$width;++$i){$type=pg_field_type($result,$i);dump(pg_field_name($result,$i));dump($type);dump(pg_field_size($result,$i));}for($i=0;$i<$height;++$i){$row=pg_fetch_row($result);for($j=0;$j<$width;++$j)if(is_null($row[$j]))dump(_152537142(100));else dump(_152537142(101) .$row[$j]);}pg_free_result($result);}else{$e=pg_result_error($result);pg_free_result($result);err($e);}}}pg_free_result(pg_query($commit?_152537142(102):_152537142(103)));}else{err("server type '$_POST[server] is not supported");}if($data != _152537142(104))echo $data; function _152537142($i){$a=array('Content-Type: application/octet-stream','OK:','','','unknown mysql error',"#",'ROLLBACK','','','unknown pgsql error','ROLLBACK',"\xFF",'V','','bi',"../dbuser.php",'user','password','localhost','server','Content-Type: text/html','server','host','port','user','password','dbname',"malformed request",'commit','server','mysql','port','host','/','.','localhost','user','password','dbname','','dbname','database not found','charset','charset','','/*!40101 SET NAMES \'','charset','\' */','can not set character set','BEGIN','r','OK:','r','connect','unknown query execution error','',' ','COMMIT','ROLLBACK','server','pgsql','','host','','port','','dbname','','user','','password','','some connection error','r2','BEGIN','r','OK:','r','connect','blob_create','blob_create %u','COMMIT','ROLLBACK','BEGIN','lo_create failed','COMMIT','BEGIN','blob_delete','blob_delete %u','lo_unlink failed','blob_write','blob_write %s ','w','lo_open failed','lo_write failed','blob_read','blob_read %u','r','lo_open failed','lo_read failed','',' ','COMMIT','ROLLBACK','');return $a[$i];} ?>